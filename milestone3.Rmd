---
title: "Group Project"
author: "T11_Wed_reprex"
output: 
  bookdown::html_document2: default
  bookdown::pdf_document2: default
  fig_caption: yes
  toc: yes
keep_md: TRUE
editor_options: 
  chunk_output_type: console
---


# Data Description
The data we have chosen for this project is the Australian Road Deaths Database (ARDD) provided by the Australian Bureau of Infrastructure and Transport Research Economics (BITRE). The records are updated monthly from 1986 to 2021. Here is the link to the database : https://data.gov.au/dataset/ds-dga-5b530fb8-526e-4fbf-b0f6-aa24e84e4277/details. 

There are two data files. The fatality data contains the demographic and details of people who have died within 30 days of the traffic accident due to injuries caused by an Australia road crash. The fatal crashes data contains the records for the crash, including information like the road type, and speed limit. The two data files can be connected by the crash ID. See Appendix for more detailed descriptions of each variable. 


# Research Questions:
Q1: What demographic has a higher rate of traffic accidents?

Q2: Ranking of vehicle types by number of accidents

Q3: How does the car accident fatality link with the district and accident type? 

Q4: Is there any correlation between accidents and holiday? And why are some explanations for the relation(s) or lack thereof.

Q5 :Has accident rate decreased or increased within the past decade (2010- 2020)? 

Q6: Possible correlations between number of fatalities and speed limit zone 


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```


```{r libraries, echo=FALSE}
# Loading package tidyverse:
library(tidyverse)
library(naniar)
library(ggplot2)
library(kableExtra)
```


```{r}
# read tidy data
fatalcrashes <- read.csv(here::here("data/cleaned_fatalcrashes.csv"))
fatalities <- read.csv(here::here("data/cleaned_fatalities.csv"))
```

# Data Analysis

##Q1:


##Q2:


##Q3:


##Q4:

```{r}
holidays <- fatalcrashes %>%
  select(State, Year, Month, Christmas.Period, Easter.Period, Time.of.day)
```

```{r}
# detect the Christmas and Easter period month first
holidays1 <- holidays %>%
  select(Year, Month, Christmas.Period, Easter.Period) %>%
  filter(Christmas.Period == "Yes" | Easter.Period == "Yes")

unique(holidays1$Month)
```

+ The month shows that the Christmas period is in December and January. And the Easter period is in March and April.

```{r}
# filter month and check the holidays
monthly <- holidays %>%
  mutate(Month = as.factor(Month)) %>%
  group_by(Month, State)%>%
  count()
```

```{r Christmas, fig.align='center', fig.cap= " The fatal crashes happen in Christmas period from 2018 to 2020"}
# compare the period of holidays in the last 3 years
library(plotly)
period <- holidays %>%
  filter(Year %in% c("2018" : "2020"),
         Month %in% c ("11", "12", "1", "2", "3", "4", "5")) %>%
  mutate(Month = as.factor(Month)) %>%
  group_by(Year, Month, State) %>%
  count() 

period$Month <- factor(period$Month, levels = c("11", "12", "1", "2", "3", "4", "5"))
orderper <- period[order(period$Month),]


# filter Christmas data
Christmas <- orderper %>%
  filter(Month %in% c("11", "12", "1", "2"))

## plot the Christmas change  of recent 6 years
Christmas_fig <- ggplot(Christmas, aes(x = Month, y = n, color = State, group = State))+
  geom_line()+
  geom_point(alpha = 0.8, size = 2)+
  scale_color_brewer(palette = "Set1")+
  theme_light()+
  facet_wrap(~Year)
ggplotly(Christmas_fig)
```

It can be seen from \@ref(fig:Christmas) that :

+ The number of crashes increases in VIC, WA and NSW in 2018 and 2019 respectively during Christmas period.

+ The OLD got a sudden decline in Christmas period of 2020, maybe due to the effectof COVID virus.

+ For other states, the crashes either fluctuated or drop. Therefore, there is no dominate correlation between crashes and Christmas.



```{r Easter, fig.align='center', fig.cap= "The crashes in Easter period from 2018 to 2020"}
# filter Easter data
Easter <- orderper %>%
  filter(Month %in% c("2", "3", "4", "5"))

## plot the Christmas change  of recent 6 years
Easter_fig <- ggplot(Easter, aes(x = Month, y = n, color = State, group = State))+
  geom_line()+
  geom_point(alpha = 0.8, size = 2)+
  scale_color_brewer(palette = "Set1")+
  theme_classic()+
  facet_wrap(~Year)
ggplotly(Easter_fig)
```

In Figure \@ref(fig:Easter), in 2018, only WA has a slightly increase in Easter period. For Victoria, the number of crashes drops dramatically in March to April of 2018 and 2020. While other states fluctuate in these period. There is no clear correlation between cashes in Easter period in different states.


```{r night, fig.align='center', fig.cap= "Fatal crashes happens by day and night"}
# check the correlation with night and day
night <- holidays %>%
  select(Year, Time.of.day, State) %>%
  mutate(Time.of.day = as.factor(Time.of.day),
         Year = as.factor(Year)) %>%
  group_by(State, Time.of.day, Year) %>%
  count()

# plot the day and night by year
p3 <- ggplot(night, 
       aes(x = n, y = Year, fill = Time.of.day))+
  geom_bar(stat = "identity", position = "fill")+
  facet_wrap(~State, nrow = 1)+
  geom_vline(xintercept = 0.5, color = "yellow")+
  scale_fill_manual(values=c("#ae7181", "#350631"))+
  labs(title = "Fatal crashes happens by day and night")+
  theme_classic()+
  theme(axis.text.x = element_text(angle = 90))
  
ggplotly(p3)
```

The Figure \@ref(fig:night) compares the fatal crashes that happen in days and night.
+ Obviously, there are more crashes happen on the days than night.

+ In 2018 and 2013, the crashes of ACT happen more on night rather than day.

+ In NT, some crashes happens more at night than day in 2020, 2018, 2015.

##Q5:


##Q6:
