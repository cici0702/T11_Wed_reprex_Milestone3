---
title: "Group Project"
author: "T11_Wed_reprex"
output: 
  bookdown::html_document2: default
  bookdown::pdf_document2: default
  fig_caption: yes
  toc: yes
keep_md: TRUE
---


# Data Description
The data we have chosen for this project is the Australian Road Deaths Database (ARDD) provided by the Australian Bureau of Infrastructure and Transport Research Economics (BITRE). The records are updated monthly from 1986 to 2021. Here is the link to the database : https://data.gov.au/dataset/ds-dga-5b530fb8-526e-4fbf-b0f6-aa24e84e4277/details. 

There are two data files. The fatality data contains the demographic and details of people who have died within 30 days of the traffic accident due to injuries caused by an Australia road crash. The fatal crashes data contains the records for the crash, including information like the road type, and speed limit. The two data files can be connected by the crash ID. See Appendix for more detailed descriptions of each variable. 


# Research Questions:
Q1: What demographic has a higher rate of traffic accidents?

Q2: Ranking of vehicle types by number of accidents

Q3: How does the car accident fatality link with the district and accident type? 

Q4: Is there any correlation between accidents and holiday? And why are some explanations for the relation(s) or lack thereof.

Q5 :Has accident rate decreased or increased within the past decade (2010- 2020)? 

Q6: Possible correlations between number of fatalities and speed limit zone 


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```


```{r libraries, echo=FALSE}
# Loading package tidyverse:
library(tidyverse)
library(naniar)
library(ggplot2)
library(kableExtra)
library(plotly)
```


```{r}
# read tidy data
fatalcrashes <- read.csv(here::here("data/cleaned_fatalcrashes.csv"))
fatalities <- read.csv(here::here("data/cleaned_fatalities.csv"))
```

# Data Analysis

##Q1:


##Q2:


##Q3:


##Q4:


##Q5:


##Q6:

```{r hp-clean-fatal, echo=F}
fatalities$Speed.Limit <-
  str_replace(fatalities$Speed.Limit, "<40", "39")
  
fatal_sl <- fatalities %>% 
  mutate(Speed.Limit = as.numeric(Speed.Limit)) %>% 
  select(Crash.ID, Year, State, Speed.Limit) %>% 
  group_by(Year, Speed.Limit) %>% 
  count() %>% 
  pivot_wider(names_from = Speed.Limit,
              values_from = n) %>% 
  mutate("<= 40" = sum(`10`, `39`, `40`, `20`, `30`, `5`, `15`, `25`, 
                     na.rm = T)) %>% 
  mutate("70-90" = sum(`70`, `75`, `80`, `90`, na.rm = T)) %>% 
  mutate(">= 100" = sum(`100`, `110`, `130`, na.rm = T)) %>% 
  select(Year, `<= 40`, `50`, `60`, `70-90`, `>= 100`) # "NA")
```

```{r hp-clean-crash, echo=F}
fatalcrashes$Speed.Limit <-
  str_replace(fatalcrashes$Speed.Limit, "<40", "39")
  
crash_sl <- fatalcrashes %>% 
  mutate(Speed.Limit = as.numeric(Speed.Limit)) %>% 
  select(Crash.ID, Year, State, Speed.Limit) %>% 
  group_by(Year, Speed.Limit) %>% 
  count() %>% 
  pivot_wider(names_from = Speed.Limit,
              values_from = n) %>% 
  mutate("<= 40" = sum(`10`, `39`, `40`, `20`, `30`, `5`, `15`, `25`, 
                     na.rm = T)) %>% 
  mutate("70-90" = sum(`70`, `75`, `80`, `90`, na.rm = T)) %>% 
  mutate(">= 100" = sum(`100`, `110`, `130`, na.rm = T)) %>% 
  select(Year, `<= 40`, `50`, `60`, `70-90`, `>= 100`) #, "NA")
```


```{r hp-table}
crash_sl %>% kbl(caption = "Yearly number of fatal crashes by speed limit (km/h)") %>% 
  kable_minimal()
```

### Analysis

The speed limits are split into 5 respective parts which is 40 and below, 50, 60, 70-90 and 100 and above, all measured in kilometer per hour (km/h). Areas which have less than 40 km/h are often shared zones, school zones and places with high density of pedestrian. 50 km/h are default speed limit within built up areas in every state in Australia except for Northern Territory. 60 km/h are sub-arterial roads, as well as the default speed within built up area in Northern Territory. 70-90 are connector and small highways. 100 and above area highways speed limits.

Between 2010 and 2020, table \@ref(tab:hp-table) showed that the overall trend in fatal crashes is reduced for speed limit zones outside built-up areas but increased for zones within built-up areas. However, within the period of 2015-2016, all zones see an increase in number of fatal crashes. The number of fatal crashes reduced or increased in varying number as well as rate across the speed zones. With the speed zones of 100 and above and 60 km/h decreased by largest proportion, about 25%.

```{r hp-pivot-longer, echo=F}
crash_sl_l <- crash_sl %>% 
  pivot_longer(crash_sl, cols = -Year, 
             names_to = "Speed_limit", values_to = "n_crashes")

fatal_sl_l <- fatal_sl %>% 
  pivot_longer(fatal_sl, cols = -Year, 
             names_to = "Speed_limit", values_to = "n_fatalities")
```


```{r hp-fig-year, fig.cap="Comparing proportion of yearly fatal crash by speed limit"}
crash_sl_l %>% mutate(Speed_limit = fct_reorder(Speed_limit, n_crashes)) %>% 
  ggplot(aes(x = as.factor(Year), 
             y = n_crashes, fill = Speed_limit)) +
  geom_col(position = "fill") +
  scale_fill_brewer(palette="Set1") +
  theme(axis.title.x = element_blank())
ggplotly()
```

### Analysis

One notable point as figure \@ref(fig:hp-fig-year) showed is throughout the period analyzed, not only is the speed zone of 100 km/h and above has highest percentage of fatal crash, but it accounts for nearly 50% of all fatal crashes in Australia. While 50 km/h and below speed zones account for less than 10% of all fatal crashes. It is generally well known that the higher the speed a vehicle is traveling at, the longer the stopping distance is, and thus fatal crash is more likely to occur on highways. Kloeden, Woolley & McLean (2007) found that following the reduction of urban speed limit from 60 to 50 km/h in South Australia in 2003, there was a 23% reduction in fatal crashes in 50 km/h zones and 16% reduction in 60 km/h zones.

```{r hp-clean-compare}
comparison_crash_fatal <- 
  left_join(crash_sl_l, fatal_sl_l, 
            by = c("Year", "Speed_limit"))

comparison_pct <- comparison_crash_fatal %>%
  group_by(Speed_limit) %>% 
  summarise(n_crashes = sum(n_crashes),
         n_fatalities = sum(n_fatalities)) %>% 
  mutate("perc_fatalities" = (n_fatalities - n_crashes)*100/n_crashes) %>% 
  arrange(perc_fatalities)

comparison_l <- comparison_pct %>% 
  select(-perc_fatalities) %>% 
  pivot_longer(cols = c(n_crashes, n_fatalities), 
               names_to = "type", values_to = "n_fatal")
```


```{r hp-fig-compare, fig.cap="Comparing number of fatalities and fatal crashes by speed zone"}
comparison_l %>% 
  mutate(Speed_limit = fct_reorder(Speed_limit, n_fatal)) %>%
  ggplot(aes(x = Speed_limit, 
             y = n_fatal, fill = type)) +
  geom_col(position = "dodge") +
  theme_bw() +
  labs(x = "Speed Limit (km/h)",
       y = "Count")
ggplotly()
```



```{r hp-fig-percent-diff, fig.cap="Percentage difference between fatalities and fatal crashes"}
comparison_pct %>% 
  mutate(Speed_limit = fct_reorder(Speed_limit, perc_fatalities)) %>%
  ggplot(aes(x = Speed_limit, y = perc_fatalities)) +
  geom_col(fill = "light blue") +
  theme_bw() +
  labs(x = "Speed Limit (km/h)",
       y = "Percent")
  ggplotly()
```

### Analysis

Figure \@ref(fig:hp-fig-compare) illustrated that not only the number of fatal crashes increased with speed limits, but number of fatalities increased as well, and in higher proportion than the increase of crashes. The difference between number of fatalities and number of crashes are made clearer in figure \@ref(fig:hp-fig-percent-diff). The percentage difference is similar in speed zones of 60 km/h and below, at around 3%. However, the difference for 70-90 km/h is approx. 8% and for highway speed is nearly 13%.

### Citations

Kloeden, C., Woolley, J., & McLean, A. J. (2007, October). A follow-up evaluation of the 50km/h default urban speed limit in South Australia. In Proceedings of.