---
title: "Group Project"
author: "T11_Wed_reprex"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    source_code: embed
keep_md: TRUE
---


# Data Description
The data we have chosen for this project is the Australian Road Deaths Database (ARDD) provided by the Australian Bureau of Infrastructure and Transport Research Economics (BITRE). The records are updated monthly from 1986 to 2021. Here is the link to the database : https://data.gov.au/dataset/ds-dga-5b530fb8-526e-4fbf-b0f6-aa24e84e4277/details. 

There are two data files. The fatality data contains the demographic and details of people who have died within 30 days of the traffic accident due to injuries caused by an Australia road crash. The fatal crashes data contains the records for the crash, including information like the road type, and speed limit. The two data files can be connected by the crash ID. See Appendix for more detailed descriptions of each variable. 


# Research Questions:
Q1: What demographic has a higher rate of traffic accidents?

Q2: Ranking of vehicle types by number of accidents

Q3: How does the car accident fatality link with the district and accident type? 

Q4: Is there any correlation between accidents and holiday? And why are some explanations for the relation(s) or lack thereof.

Q5 :Has accident rate decreased or increased within the past decade (2010- 2020)? 

Q6: Possible correlations between number of fatalities and speed limit zone 


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```


```{r libraries, echo=FALSE}
# Loading package tidyverse:
library(tidyverse)
library(naniar)
library(ggplot2)
library(kableExtra)
library(plotly)
library(flexdashboard)
```


```{r}
# read tidy data
fatalcrashes <- read.csv(here::here("data/cleaned_fatalcrashes.csv"))
fatalities <- read.csv(here::here("data/cleaned_fatalities.csv"))
```

# Data Analysis

##Q1:


##Q2:


##Q3:


##Q4:


##Q5:


Speed Limit Analysis {data-icon="fa-tachometer-alt"}
====================

```{r hp-clean-fatal}
fatalities$Speed.Limit <-
  str_replace(fatalities$Speed.Limit, "<40", "39")
  
fatal_sl <- fatalities %>% 
  mutate(Speed.Limit = as.numeric(Speed.Limit)) %>% 
  select(Crash.ID, Year, State, Speed.Limit) %>% 
  group_by(Year, Speed.Limit) %>% 
  count() %>% 
  pivot_wider(names_from = Speed.Limit,
              values_from = n) %>% 
  mutate("<= 40" = sum(`10`, `39`, `40`, `20`, `30`, `5`, `15`, `25`, 
                     na.rm = T)) %>% 
  mutate("70-90" = sum(`70`, `75`, `80`, `90`, na.rm = T)) %>% 
  mutate(">= 100" = sum(`100`, `110`, `130`, na.rm = T)) %>% 
  select(Year, `<= 40`, `50`, `60`, `70-90`, `>= 100`) # "NA")
```

```{r hp-clean-crash}
fatalcrashes$Speed.Limit <-
  str_replace(fatalcrashes$Speed.Limit, "<40", "39")
  
crash_sl <- fatalcrashes %>% 
  mutate(Speed.Limit = as.numeric(Speed.Limit)) %>% 
  select(Crash.ID, Year, State, Speed.Limit) %>% 
  group_by(Year, Speed.Limit) %>% 
  count() %>% 
  pivot_wider(names_from = Speed.Limit,
              values_from = n) %>% 
  mutate("<= 40" = sum(`10`, `39`, `40`, `20`, `30`, `5`, `15`, `25`, 
                     na.rm = T)) %>% 
  mutate("70-90" = sum(`70`, `75`, `80`, `90`, na.rm = T)) %>% 
  mutate(">= 100" = sum(`100`, `110`, `130`, na.rm = T)) %>% 
  select(Year, `<= 40`, `50`, `60`, `70-90`, `>= 100`) #, "NA")
```

Row
------------------

### Table 6.1: Yearly number of fatal crashes by speed limit

```{r hp-table}
crash_sl %>% kbl() %>% 
  kable_minimal()
```


```{r hp-pivot-longer}
crash_sl_l <- crash_sl %>% 
  pivot_longer(crash_sl, cols = -Year, 
             names_to = "Speed_limit", values_to = "n_crashes")

fatal_sl_l <- fatal_sl %>% 
  pivot_longer(fatal_sl, cols = -Year, 
             names_to = "Speed_limit", values_to = "n_fatalities")
```

### Figure 6.1: Comparing proportion of yearly fatal crash by speed limit

```{r hp-fig-year}
crash_sl_l %>% mutate(Speed_limit = fct_reorder(Speed_limit, n_crashes)) %>% 
  ggplot(aes(x = as.factor(Year), 
             y = n_crashes, fill = Speed_limit)) +
  geom_col(position = "fill") +
  scale_fill_brewer(palette="Set1") +
  theme(axis.title.x = element_blank())
ggplotly()
```

```{r hp-clean-compare}
comparison_crash_fatal <- 
  left_join(crash_sl_l, fatal_sl_l, 
            by = c("Year", "Speed_limit"))

comparison_pct <- comparison_crash_fatal %>%
  group_by(Speed_limit) %>% 
  summarise(n_crashes = sum(n_crashes),
         n_fatalities = sum(n_fatalities)) %>% 
  mutate("perc_fatalities" = (n_fatalities - n_crashes)*100/n_crashes) %>% 
  arrange(perc_fatalities)

comparison_l <- comparison_pct %>% 
  select(-perc_fatalities) %>% 
  pivot_longer(cols = c(n_crashes, n_fatalities), 
               names_to = "type", values_to = "n_fatal")
```

Row
--------------

### Figure 6.2: Comparing number of fatalities and fatal crashes by speed zone

```{r hp-fig-compare}
comparison_l %>% 
  mutate(Speed_limit = fct_reorder(Speed_limit, n_fatal)) %>%
  ggplot(aes(x = Speed_limit, 
             y = n_fatal, fill = type)) +
  geom_col(position = "dodge") +
  theme_bw() +
  labs(x = "Speed Limit",
       y = "Count")
ggplotly()
```

### Figure 6.3: Percentage difference between fatalities and fatal crashes

```{r hp-fig-percent-diff}
comparison_pct %>% 
  mutate(Speed_limit = fct_reorder(Speed_limit, perc_fatalities)) %>%
  ggplot(aes(x = Speed_limit, y = perc_fatalities)) +
  geom_col(fill = "light blue") +
  theme_bw() +
  labs(x = "Speed Limit",
       y = "Percent")
  ggplotly()
```

### Analysis

- Table 6.1 showed between 2010 and 2020, fatal crashes is reduced for higher speed zones but increased for lower speed zones

- The speed zone >= 100 kmph accounts for nearly 50% of all fatal crashes in Australia

- Number of fatal crashes and fatalities both increased with speed limits

- Fatalities is 3% higher than number of fatal crashes at lower speed zone, but increase up to 13% for higher speed zone